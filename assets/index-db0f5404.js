(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}})();const _="modulepreload",h=function(t){return"/pqkms-web/"+t},m={},g=function(e,s,o){if(!s||s.length===0)return e();const r=document.getElementsByTagName("link");return Promise.all(s.map(n=>{if(n=h(n),n in m)return;m[n]=!0;const i=n.endsWith(".css"),d=i?'[rel="stylesheet"]':"";if(!!o)for(let l=r.length-1;l>=0;l--){const c=r[l];if(c.href===n&&(!i||c.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${d}`))return;const a=document.createElement("link");if(a.rel=i?"stylesheet":_,i||(a.as="script",a.crossOrigin=""),a.href=n,document.head.appendChild(a),i)return new Promise((l,c)=>{a.addEventListener("load",l),a.addEventListener("error",()=>c(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e()).catch(n=>{const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=n,window.dispatchEvent(i),!i.defaultPrevented)throw n})};async function p(t,e,s,o,r){return(await g(()=>import("./registration-b9dfdd9e.js"),["assets/registration-b9dfdd9e.js","assets/auth_base-f1c2b218.js"])).register_user(t,e,s,o,r)}async function y(t,e){const s=await g(()=>import("./login-d022b852.js"),["assets/login-d022b852.js","assets/auth_base-f1c2b218.js"]),o=`https://${t.access_url}`;return s.login_user(t.domain_name,t.user_name,e,t.salt,t.auth_algo,o)}async function v(t,e){let s=`${t}/v0/admin/user_info?user_name=${e}`;const o=await fetch(s,{mode:"cors",cache:"no-store"});if(o.ok)return(await o.json()).message;{const r=await o.json();throw new Error(`Server error: ${r.code} => ${r.message}`)}}const f="body > div.registration > div.read-the-docs",w="body > div.login > div.read-the-docs";async function E(t){let e=new FormData(t),s=e.get("domain"),o=e.get("email"),r=e.get("password");return p(s.trim(),o.trim(),r,"https://registrar.pqkms.dev:8443")}async function S(t){let e=new FormData(t),s=e.get("email"),o=e.get("password"),r=await v("https://registrar.pqkms.dev:8443",s.trim()),i=await(await y(r[0],o)).enclaveSigningKey(),d=await globalThis.crypto.subtle.exportKey("jwk",i);return JSON.stringify(d)}function L(){return document.querySelector("body > div.registration")}function T(t){let e=document.querySelector(t);if(e)return e;{let s=L();if(s){let o=document.createElement("div");return s.appendChild(o),o}else return null}}function u(t,e){let s=T(t);s&&(s.innerText=e)}const b=t=>{t.preventDefault(),t.currentTarget?E(t.currentTarget).then(e=>u(f,e)).catch(e=>{u(f,`Registration failed: ${e.message}`)}):u(f,"Invalid event target for registration form")},R=t=>{t.preventDefault(),t.currentTarget?S(t.currentTarget).then(e=>u(w,e)).catch(e=>{alert(`Login failed: ${e}`)}):alert("Invalid event target for registration form")},O=()=>{const t=document.querySelector("body > div.registration > form"),e=document.querySelector("body > div.login > form");t&&t.addEventListener("submit",b),e&&e.addEventListener("submit",R)};O();export{g as _};
